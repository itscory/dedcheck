RED='\033[0;31m';GREEN='\033[92m';NC='\033[0m' ;color=${NC} ;echo -ne "\n";echo "Hostname: $(hostname)";echo "Main IP: $(hostname -i)";if [[ $(/usr/local/cpanel/cpkeyclt) = *"Update succeeded"* ]];then dedcheck_cpanellicensestatus=Active;else dedcheck_cpanellicensestatus="${RED}Invalid${NC}";fi;echo -e "cPanel License: $dedcheck_cpanellicensestatus";echo "IPs:" $(/usr/local/cpanel/scripts/ipusage |wc -l);echo "cPanel Accounts: $(cat /etc/trueuserdomains |wc -l)";if [ -d /etc/cpanel/ea4 ];then eaversion="EasyApache 4";color=${NC};else eaversion="EasyApache 3";color=${RED};fi;echo -e "${color}EA Version: $eaversion${NC}";if [ -s /etc/csf ];then firewall=CSF;else if [ -s /etc/apf ];then firewall=APF;else firewall=UNKNOWN;fi;fi;echo "Firewall: $firewall";echo -ne "\n";echo "------Load------";dedcheck_load=$(uptime | grep -ohe 'load average[s:][: ].*' | awk '{ print $3 }' |sed 's|[,]||g');dedcheck_load=$( printf "%.0f" $dedcheck_load );color=${NC};if [ $dedcheck_load -gt $(nproc) ];then color=${RED};fi;echo -e "${color}Load: $(uptime | awk -F'[a-z]:' '{ print $2}')${NC}";color=${NC};echo "CPUs: $(nproc)";echo -ne "\n";echo "------Exim------";if [ -s /etc/mailips ];then mailip=$(grep "*:" /etc/mailips |awk '{print $2}');else mailip=$(hostname -i);fi;echo "Mail IP: $mailip";rdns=$(dig @ns1.inmotionhosting.com -x $mailip +short);if ! [ "$(hostname)." == "$rdns" ];then color=${RED};else color=${NC};fi;echo -e "${color}rDNS: $(dig @ns1.inmotionhosting.com -x $mailip +short)${NC}";isspamming=1 ;queue=$(exim -bpc);if [ $queue -gt 100 ];then color=${RED};isspamming=1;else color=${NC};fi;echo -e "${color}Queue: $(exim -bpc)${NC}";echo -ne "\n";if [ "$isspamming" == "1" ];then echo "------Dovecot emails sent since $(head -1 /var/log/exim_mainlog |awk '{print $1}')------";grep "A=dovecot_login" /var/log/exim_mainlog | awk -F"A=dovecot_login:" {'print $2'} | cut -f1 -d' ' | sort | uniq -c | sort -n | awk {'print $1, " unique emails sent by " , $2'};echo -ne "\n";fi;echo "------Disk------";dedcheck_oldIFS=$IFS;IFS=$'\n';dedcheck_dfhead=$(df -h |grep --color=never ^Filesystem);dedcheck_devdisks=$(df -h |grep --color=never ^/dev);echo $dedcheck_dfhead;for i in $dedcheck_devdisks;do if [ $(echo $i |awk '{print $5}' | tr -d '%') -gt '90' ];then color=${RED};else color=${NC};fi;echo -e "${color}$i${NC}";done;echo -ne "\n";dedcheck_idfhead=$(df -ih |grep --color=never ^Filesystem);dedcheck_idevdisks=$(df -ih |grep --color=never ^/dev);echo $dedcheck_idfhead;for i in $dedcheck_idevdisks;do if [ $(echo $i |awk '{print $5}' | tr -d '%') -gt '90' ];then color=${RED};else color=${NC};fi;echo -e "${color}$i${NC}";done;IFS=$dedcheck_oldIFS;echo -ne "\n";for service in httpd exim cpanel mysql named dovecot;do if ! (( $(ps -ef | grep -v grep | grep -c $service) > 0 ));then echo -e "${RED} ! ! ! $service is DOWN ! ! ! ${NC}";fi;done;for service in nginx varnish redis memcache;do if (( $(ps -ef | grep -v grep | grep -c $service) > 0 ));then echo -e "${RED} ! ! ! $service is RUNNING ! ! ! ${NC}";fi;done;echo -ne "\n";
